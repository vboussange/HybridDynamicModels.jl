<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home ¬∑ HybridDynamicModels.jl</title><meta name="title" content="Home ¬∑ HybridDynamicModels.jl"/><meta property="og:title" content="Home ¬∑ HybridDynamicModels.jl"/><meta property="twitter:title" content="Home ¬∑ HybridDynamicModels.jl"/><meta name="description" content="Documentation for HybridDynamicModels.jl."/><meta property="og:description" content="Documentation for HybridDynamicModels.jl."/><meta property="twitter:description" content="Documentation for HybridDynamicModels.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="assets/logo.svg" alt="HybridDynamicModels.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>HybridDynamicModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Key-Features"><span>üöÄ Key Features</span></a></li><li><a class="tocitem" href="#Installation"><span>üì¶ Installation</span></a></li><li><a class="tocitem" href="#Quick-Start"><span>üî• Quick Start</span></a></li><li><a class="tocitem" href="#Documentation"><span>üìö Documentation</span></a></li><li><a class="tocitem" href="#Acknowledgments"><span>üôè Acknowledgments</span></a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="examples/data_loading/">Data Loading with <code>SegmentedTimeSeries</code></a></li><li><a class="tocitem" href="examples/sgd_example/">Training with <code>SGDBackend</code></a></li><li><a class="tocitem" href="examples/mcsampling_example/">Bayesian inference with <code>MCSamplingBackend</code></a></li><li><a class="tocitem" href="examples/customtraining_example/">Overloading the <code>train</code> function</a></li></ul></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/vboussange/HybridDynamicModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/vboussange/HybridDynamicModels.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><table><tr><th style="text-align: center"><strong>Documentation</strong></th><th style="text-align: center"><strong>Build Status</strong></th><th style="text-align: center"><strong>Julia</strong></th><th style="text-align: center"><strong>Testing</strong></th></tr><tr><td style="text-align: center"><a href="https://vboussange.github.io/HybridDynamicModels.jl/stable/"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="docs-stable"/></a> <a href="https://vboussange.github.io/HybridDynamicModels.jl/dev/"><img src="https://img.shields.io/badge/docs-dev-blue.svg" alt="docs-dev"/></a></td><td style="text-align: center"><a href="https://github.com/vboussange/HybridDynamicModels.jl/actions/workflows/CI.yml?query=branch%3Amain"><img src="https://github.com/vboussange/HybridDynamicModels.jl/actions/workflows/CI.yml/badge.svg?branch=main" alt="CI"/></a></td><td style="text-align: center"><a href="https://julialang.org/"><img src="https://img.shields.io/badge/julia-v1.10+-blue.svg" alt="Julia"/></a> <a href="https://github.com/SciML/SciMLStyle"><img src="https://img.shields.io/static/v1?label=code%20style&amp;message=SciML&amp;color=9558b2&amp;labelColor=389826" alt="Code Style: Blue"/></a></td><td style="text-align: center"><a href="https://github.com/JuliaTesting/Aqua.jl"><img src="https://raw.githubusercontent.com/JuliaTesting/Aqua.jl/master/badge.svg" alt="Aqua QA"/></a> <a href="https://codecov.io/gh/vboussange/HybridDynamicModels.jl"><img src="https://codecov.io/gh/vboussange/HybridDynamicModels.jl/branch/main/graph/badge.svg" alt="codecov"/></a></td></tr></table><p><img src="https://github.com/vboussange/HybridDynamicModels.jl/blob/main/docs/src/assets/logo.svg" alt/></p><h1 id="HybridDynamicModels.jl"><a class="docs-heading-anchor" href="#HybridDynamicModels.jl">HybridDynamicModels.jl</a><a id="HybridDynamicModels.jl-1"></a><a class="docs-heading-anchor-permalink" href="#HybridDynamicModels.jl" title="Permalink"></a></h1><p><em><a href="https://github.com/LuxDL/Lux.jl">Lux.jl</a> layers and utilities to build and train hybrid dynamic models.</em></p><hr/><p><code>HybridDynamicModels.jl</code> is a toolbox for easily building and training hybrid dynamic models which combine mechanistic and data driven components. Built on top of the deep learning framework <code>Lux.jl</code>, it enables both gradient descent optimization and Bayesian inference.</p><h2 id="Key-Features"><a class="docs-heading-anchor" href="#Key-Features">üöÄ Key Features</a><a id="Key-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Features" title="Permalink"></a></h2><h3 id="**Dynamic-model-layers**"><a class="docs-heading-anchor" href="#**Dynamic-model-layers**"><strong>Dynamic model layers</strong></a><a id="**Dynamic-model-layers**-1"></a><a class="docs-heading-anchor-permalink" href="#**Dynamic-model-layers**" title="Permalink"></a></h3><ul><li><strong><code>ICLayer</code></strong>: For initial condition inference</li><li><strong><code>ODEModel</code></strong>: Neural ODEs</li><li><strong><code>ARModel</code></strong>: Autoregressive models</li><li><strong><code>AnalyticModel</code></strong>: For explicit dynamical models</li></ul><h3 id="**Utility-layers-for-hybrid-modeling**"><a class="docs-heading-anchor" href="#**Utility-layers-for-hybrid-modeling**"><strong>Utility layers for hybrid modeling</strong></a><a id="**Utility-layers-for-hybrid-modeling**-1"></a><a class="docs-heading-anchor-permalink" href="#**Utility-layers-for-hybrid-modeling**" title="Permalink"></a></h3><ul><li><strong><code>ParameterLayer</code></strong>: Learnable parameters, composable with optional <code>Constraint</code> layers</li><li><strong><code>BayesianLayer</code></strong>: Add probabilistic priors to any Lux layer</li></ul><h3 id="**Data-loaders**"><a class="docs-heading-anchor" href="#**Data-loaders**"><strong>Data loaders</strong></a><a id="**Data-loaders**-1"></a><a class="docs-heading-anchor-permalink" href="#**Data-loaders**" title="Permalink"></a></h3><ul><li><strong><code>SegmentedTimeSeries</code></strong>: Time series data loader with segmentation, implementing mini-batching.</li></ul><h3 id="**Training-API,-with-following-backends**"><a class="docs-heading-anchor" href="#**Training-API,-with-following-backends**"><strong>Training API, with following backends</strong></a><a id="**Training-API,-with-following-backends**-1"></a><a class="docs-heading-anchor-permalink" href="#**Training-API,-with-following-backends**" title="Permalink"></a></h3><ul><li><strong><code>SGDBackend</code></strong>: Gradient descent optimization with <a href="https://github.com/FluxML/Optimisers.jl"><code>Optimisers.jl</code></a> and <a href="https://github.com/LuxDL/Lux.jl"><code>Lux.jl</code> training API</a></li><li><strong><code>MCSamplingBackend</code></strong>: Full Bayesian inference with uncertainty quantification using <a href="https://github.com/TuringLang/DynamicPPL.jl"><code>DynamicPPL.jl</code></a> and <a href="https://github.com/TuringLang/Turing.jl"><code>Turing.jl</code></a>.</li></ul><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">üì¶ Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Pkg
Pkg.add(&quot;HybridDynamicModels&quot;)</code></pre><h2 id="Quick-Start"><a class="docs-heading-anchor" href="#Quick-Start">üî• Quick Start</a><a id="Quick-Start-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start" title="Permalink"></a></h2><h3 id="Autoregressive-hybrid-model"><a class="docs-heading-anchor" href="#Autoregressive-hybrid-model">Autoregressive hybrid model</a><a id="Autoregressive-hybrid-model-1"></a><a class="docs-heading-anchor-permalink" href="#Autoregressive-hybrid-model" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Lux
using HybridDynamicModels
using Random

# Dense layer for interactions
interaction_layer = Dense(2, 2, tanh)

# Parameter layer for growth/decay rates
rate_params = ParameterLayer(init_value = (growth = [0.1], decay = [0.05]),
    constraint = NamedTupleConstraint((; growth = BoxConstraint([0.0], [1.0]),
        decay = BoxConstraint([0.0], [1.0]))
    )
)

# Simple hybrid dynamics: linear terms + neural interactions
function ar_step(layers, u, ps, t)
    # Linear terms from parameters
    params = layers.rates(ps.rates)
    growth = vcat(params.growth, -params.decay)

    # Neural network interactions
    interactions = layers.interaction(u, ps.interaction)

    return u .* (growth + interactions)
end

# Create autoregressive model
model = ARModel(
    (interaction = interaction_layer, rates = rate_params),
    ar_step;
    dt = 0.1)

ps, st = Lux.setup(Random.default_rng(), model)
tsteps = range(0, stop = 10.0, step = 0.1)

preds, _ = model(
    (; u0 = [1.0, 1.0],
        tspan = (tsteps[1], tsteps[end]),
        saveat = tsteps), ps, st)
size(preds)  # (2, 101)</code></pre><p>We can predict batches of time series by providing a batch of initial conditions.</p><pre><code class="language-julia hljs">x = [(; u0 = rand(2),
         tspan = (tsteps[1], tsteps[end]),
         saveat = tsteps) for _ in 1:5]
batch_preds, _ = model(x, ps, st)
size(batch_preds)  # (2, 101, 5)</code></pre><p>We can bind our <code>model</code> with an additional layer predicting initial conditions from some other input data using the <code>ICLayer</code>.</p><pre><code class="language-julia hljs">ic_layer = ICLayer(Dense(10, 2, tanh))
model_with_ic = Chain(ic_layer, model)
ps, st = Lux.setup(Random.default_rng(), model_with_ic)
x = [(; u0 = rand(10),
         tspan = (tsteps[1], tsteps[end]),
         saveat = tsteps) for _ in 1:5]
batch_preds, _ = model_with_ic(x, ps, st)
size(batch_preds)  # (2, 101, 5)</code></pre><p>A similar workwflow can be used with <code>ODEModel</code> and <code>AnalyticModel</code>.</p><h3 id="Training-with-Optimisers.jl-through-the-SGDBackend"><a class="docs-heading-anchor" href="#Training-with-Optimisers.jl-through-the-SGDBackend">Training with <code>Optimisers.jl</code> through the <code>SGDBackend</code></a><a id="Training-with-Optimisers.jl-through-the-SGDBackend-1"></a><a class="docs-heading-anchor-permalink" href="#Training-with-Optimisers.jl-through-the-SGDBackend" title="Permalink"></a></h3><blockquote><p>‚ö†Ô∏è The default <code>train</code> function with the <code>InferICs</code> setup is opiniated and meant for demonstration purposes. You are encouraged <a href="https://vboussange.github.io/HybridDynamicModels.jl/stable/examples/customtraining_example/">to define your own training pipeline</a>.</p></blockquote><pre><code class="language-julia hljs">using Lux, Optimisers, ComponentArrays # conditional loading to use `SGDBackend`
using Zygote
data = rand(2, length(tsteps))
dataloader = SegmentedTimeSeries((data, tsteps); segment_length = 10, shift = 2)

backend = SGDBackend(Adam(1e-2), 100, AutoZygote(), MSELoss())
result = train(backend, model, dataloader, InferICs(false))

tspan = (tsteps[1], tsteps[end])
prediction, _ = model(
    (; u0 = result.ics[1].u0,
        tspan = tspan,
        saveat = tsteps), result.ps, result.st)</code></pre><h3 id="Bayesian-inference-with-Turing.jl-through-the-MCSamplingBackend"><a class="docs-heading-anchor" href="#Bayesian-inference-with-Turing.jl-through-the-MCSamplingBackend">Bayesian inference with <code>Turing.jl</code> through the <code>MCSamplingBackend</code></a><a id="Bayesian-inference-with-Turing.jl-through-the-MCSamplingBackend-1"></a><a class="docs-heading-anchor-permalink" href="#Bayesian-inference-with-Turing.jl-through-the-MCSamplingBackend" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Distributions, Turing, ComponentArrays # conditional loading to use `MCSamplingBackend`

rate_priors = (
    growth = arraydist([Normal(0.1, 0.05)]),
    decay = arraydist([Normal(0.05, 0.02)])
)
nn_priors = Normal(0, 1)  # Example prior for NN weights

# Create Bayesian model
bayesian_model = ARModel(
    (interaction = BayesianLayer(interaction_layer, nn_priors),
        rates = BayesianLayer(rate_params, rate_priors)),
    ar_step;
    dt = 0.1
)

datadistrib = Normal
mcmc_backend = MCSamplingBackend(NUTS(0.65), 500, datadistrib)
result = train(mcmc_backend,
    bayesian_model,
    dataloader,
    InferICs(false))

# Sample from posterior
chains = result.chains
posterior_samples = sample(bayesian_model, chains, 50)</code></pre><h2 id="Documentation"><a class="docs-heading-anchor" href="#Documentation">üìö Documentation</a><a id="Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation" title="Permalink"></a></h2><p>Check out <a href="https://vboussange.github.io/HybridDynamicModels.jl/stable/examples/data_loading/">the tutorials</a> and the <a href="https://vboussange.github.io/HybridDynamicModels.jl/stable/api/">API</a> in <a href="https://vboussange.github.io/HybridDynamicModels.jl/dev/">the documentation</a>.</p><h2 id="Acknowledgments"><a class="docs-heading-anchor" href="#Acknowledgments">üôè Acknowledgments</a><a id="Acknowledgments-1"></a><a class="docs-heading-anchor-permalink" href="#Acknowledgments" title="Permalink"></a></h2><p>Built on the excellent LuxDL, SciML and TuringLang ecosystems:</p><ul><li><a href="https://github.com/LuxDL/Lux.jl">Lux.jl</a> for neural networks</li><li><a href="https://github.com/TuringLang/Turing.jl">Turing.jl</a> for Bayesian inference</li><li><a href="https://github.com/SciML/SciMLSensitivity.jl">SciMLSensitivity.jl</a> for automatic differentiation</li><li><a href="https://github.com/SciML/OrdinaryDiffEq.jl">OrdinaryDiffEq.jl</a> for differential equations</li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="examples/data_loading/">Data Loading with <code>SegmentedTimeSeries</code> ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 25 September 2025 15:31">Thursday 25 September 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
